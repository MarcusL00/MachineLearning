<div>
  <h2>Results</h2>
  <div id="results-container">
    <div
      id="results-loading"
      class="htmx-indicator"
      aria-hidden="true"
      style="align-items: center; gap: 8px; margin-bottom: 12px"
    >
      <span class="loader" aria-hidden="true"></span>
    </div>
  </div>

  <script>
    // Show the results-loading indicator when the model form triggers a request,
    // and hide it when the request finishes. This uses HTMX lifecycle events.
    ;(function () {
      const indicator = document.getElementById('results-loading')
      if (!indicator) return

      document.body.addEventListener('htmx:beforeRequest', function (evt) {
        try {
          const trigger = evt.detail && evt.detail.elt
          if (!trigger) return
          // If the request originates from inside the model form, show the indicator
          if (
            trigger.id === 'model-form' ||
            (trigger.closest && trigger.closest('#model-form'))
          ) {
            // Replace the current results with a lightweight loading state so
            // users see the spinner immediately instead of the old results.
            const resultsContainer =
              document.getElementById('results-container')
            if (resultsContainer) {
              resultsContainer.innerHTML = `
                <div id="results-loading" class="htmx-indicator htmx-request" aria-hidden="false" style="align-items: center; gap: 8px; margin-bottom: 12px">
                  <span class="loader" aria-hidden="true" style="color: var(--primary-color)"></span>
                </div>
              `
            }
            // also set the standalone indicator (if present) for accessibility
            indicator.classList.add('htmx-request')
            indicator.setAttribute('aria-hidden', 'false')
          }
        } catch (e) {
          console.error(e)
        }
      })

      document.body.addEventListener('htmx:afterRequest', function (evt) {
        try {
          const trigger = evt.detail && evt.detail.elt
          if (!trigger) return
          if (
            trigger.id === 'model-form' ||
            (trigger.closest && trigger.closest('#model-form'))
          ) {
            indicator.classList.remove('htmx-request')
            indicator.setAttribute('aria-hidden', 'true')
            // HTMX will swap the real response into #results-container.
            // No further DOM cleanup is required here.
          }
        } catch (e) {
          console.error(e)
        }
      })
    })()
  </script>
</div>
